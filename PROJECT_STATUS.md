# 📘 PROJECT_STATUS v0.7.20

**— F9-D / F9-B 完了 ＋ F9-A（質問セット・条例バインディング／実装仕様）確定版 —**

**Last Updated:** 2025-12-31  
**Maintainer:** Sumio Nishioka & ChatGPT (Architect Role)

---

## 0. フェーズ定義の統一（不変）

本プロジェクトのフェーズ定義は、  
**Roadmap を唯一の正本**として以下に統一する。

| フェーズ | 内容 |
| -------- | ---- |
| F1 | 設計フェーズ |
| F2 | Page Object 実装フェーズ |
| F3 | Answer Detection & テスト基盤構築フェーズ |
| F4 | RAG 入力差分影響の観測・試験データ提供フェーズ |
| F5 | CI（e2e.yml）整備フェーズ |
| F6 | LGWAN 対応フェーズ（保留） |
| F7-A | 運用準備フェーズ |
| F7-B | 制御付き実運用試行フェーズ |
| F7-C | 拡張試行フェーズ |
| **F8** | **Markdown変換検証フェーズ** |
| **F9** | **評価可能データ安定提供フェーズ** |

※ F7 は A / B / C の段階構造を持つ。

---

## 1. Current Phase（現在地）

### **F8：Markdown変換検証フェーズ（完了）**

- HTML→Markdown 変換を前提とした回答収集の技術的検証が完了
- 全質問について answer.md（Raw / Extracted / Metadata）が必ず生成されることを確認
- 回答の評価・優劣判断を行わない非評価モデルを維持
- **F9 に引き渡し可能な観測データ一式を確保**
- F8 の責務は **すべて完了**

---

### **F9：評価可能データ安定提供フェーズ（進行中）**

- F8 成果物を対象に、  
  **評価を行わずに「評価可能な状態」を安定提供するための整理・是正フェーズ**
- 回答の評価・採点・品質判断は **一切行わない**

---

#### **F9-C：Extracted 正本化（完了）**

- DOM スコープ規則を仕様として確定
- Extracted を評価入力の正本と定義
- Raw / Extracted の起点 DOM を単一 Anchor に統一
- Extracted 不取得時は必ず INVALID と判定する安全設計を確立

※ 正本：`docs/spec/Spec_F9-C_DOM_Scope_Rules_v0.2.md`

---

#### **F9-D：下流フェーズ整合（完了）**

**目的：**

- F9-C で確定した Raw / Extracted / Metadata.status を前提として、
- 下流（F4 / rag_entry / dataset / writer）が  
  **意味を持たずに追従できる構造を確定させる**

**到達点（確定）：**

- dataset の論理単位（rag_entry 集合）を FIX
- Schema_dataset_v0.2 を FIX
- dataset.yaml v0.2 を **実体として生成**
- build_dataset_from_f8 による構築を実証
- verify-diff により **コピー完全性（差分なし）を実証**
- pytest 非依存・人間実行前提で検証可能な運用を成立させた
- **Raw / answer.md の I/F を最終仕様として FIX**

※ 正本： `docs/spec/Spec_F9-D_Raw_and_Answer_Interface_v0.1r.md`

---

#### **F9-B：実行条件固定・ナレッジ切替（完了）**

**目的：**

- 比較実験における実行条件を固定し、
- ナレッジベース切替を
  **「再投入」ではなく「アカウント差分」によって行う方式を
  F9 の正式実装として確定する**

**到達点（確定）：**

- ナレッジ切替は **アカウント切替によって行う**方針を FIX
- 1 アカウント内での  
  **ナレッジ削除・再アップロード方式を禁止**
- 実行条件差分を  
  **アカウント差分に集約する設計原則を確定**
- `.env` ファイル切替による実行環境固定を  
  **F9 の正式実装対象として確定**
- `.env` 切替スクリプトを  
  **F9 成果物として実装・確定**
- Windows 環境向けに、一般職員が  
  コマンド入力なしで実行できる  
  バッチファイルを提供
- 職員向け README.txt を追加し、  
  実行前提と操作範囲を明文化
- F4 における実証結果を  
  **設計判断の根拠として明文化**

※ 正本：`docs/spec/Spec_F9-B_Execution_Conditions_Freeze_v0.1r.md`

---

#### **F9-A：質問セット・条例バインディング確定（仕様／実装仕様確定）**

**目的：**

- 抽象的に記述されたゴールデン質問を維持したまま、
- 条例 ID／条／項を構造的に確定し、
- 後続フェーズに **曖昧さのない実行用質問**を渡す

**設計判断（確定）：**

- 質問セットは **1 つのみ**定義する
- 条例ごとの差異は **条例バインディング**で表現する
- F9-A は条例データに基づき  
  条・項を **必ず探索・特定する**
- 条・項を未解決のまま後続フェーズへ渡すことは禁止
- 自動探索で解決できない場合は  
  **ユーザー入力または補助手段を用いて必ず解決する**

**実装仕様（確定）：**

- F9-A の処理フローを実装拘束レベルで定義
- 自動探索／ユーザー入力を組み合わせた解決保証制御を採用
- 後続フェーズへ渡す前に入力完全性ゲートを設ける

※ 正本：

- `docs/spec/Spec_F9-A_Question_Set_and_Binding_v0.1r.md`
- `docs/spec/Spec_F9-A_Implementation_v0.1r.md`

---

## 2. 設計・構造面での更新（v0.7.20）

- **Spec_F9-A_Implementation_v0.1r を追加**
  - F9-A の処理順序・責務境界・解決保証制御を明文化
  - 実装言語／UI 非依存の拘束仕様として確定
- **F9 Backlog A を詳細チェックリスト化**
  - 完了判定可能な作業単位へ分解
  - F9-A の到達条件を明確化

---

## 3. プロジェクトの到達点（更新）

- F1–F3：再現可能な E2E テスト基盤
- F4：RAG 入力差分影響の観測データ生成（実証）
- F5：最小 CI
- F7-C：制御付き実運用試行
- **F8：回答素材収集基盤の技術成立**
- **F9-C：Extracted 正本化 完了**
- **F9-D：dataset / Raw / answer.md I/F 最終確定**
- **F9-B：実行条件固定・ナレッジ切替仕様 FIX**
- **F9-A：質問解決・条例参照構造の仕様／実装仕様確定**

---

## 4. 完了済み成果（更新）

### ✅ F9-B（仕様・実装 完了）

- 実行条件固定の設計原則を確定
- ナレッジ切替をアカウント差分で行う方式を正式採用
- `.env` 切替を用いた実行モデルを仕様として固定
- 再投入方式を比較実験上の禁止事項として明文化
- .env 切替スクリプト（CLI）実装完了
- Windows バッチによる非CLI利用導線を確立
- 職員向け説明文書（README.txt）を成果物として確定

---

## 5. 評価・判断に関する前提（不変）

以下は **本プロジェクトでは扱わない**。

- 回答の正誤・品質・有用性の評価
- HTML / Markdown の優劣判断（ナレッジ形式の是非判定）
- 品質スコアリング・ランキング

これらは **後続プロジェクトで扱う前提**とする。

---

## 6. ナレッジ形式と本プロジェクトの責務境界（不変）

本プロジェクトは、**ナレッジベースに格納される原データ形式
（HTML / Markdown）の妥当性・優劣を判断しない**。

### 6.1 責務の切り分け（不変）

- **ナレッジ形式（HTML / Markdown）の設計・変換・妥当性評価**
  - 例規 HTML 変換プロジェクトの専管事項とする
- **本プロジェクト（Qommons.AI テスト自動化）**
  - ナレッジ形式を入力条件の一つとして受け入れる
  - UI が返す回答（HTML）を、
    設計どおりに観測・抽出・保存できるかのみを検証対象とする

### 6.2 本プロジェクトにおける「評価」の定義

本プロジェクトにおける評価とは、
**回答内容の正誤・品質・表現の適切性を判定することではない**。

評価対象は以下に限定される。

- submit → probe → DOM 抽出 → answer.md 生成が成立するか
- probe 例外が execution flow を破壊しないか
- DOM 構造差分や UI ノイズが存在しても、
  観測事実と証跡が失われないか
- Extracted が VALID / INVALID として一意に状態判定されるか

### 6.3 HTML / Markdown ナレッジの扱い方針

- HTML / Markdown は **比較・観測条件の一つ**として扱う
- どちらが「正しい」「望ましい」かは、
  本プロジェクトでは結論づけない
- ナレッジ形式差分によって観測された挙動は、
  **一次情報として記録し、後続プロジェクトに引き渡す**

本方針は、F8 / F9 を通じて一貫して適用される。

---

## 7. Backlog 記述ルール（不変）

本プロジェクトにおける Backlog は、
**未解決の状態ではなく、解決するための作業単位**を記述する。

- 状態記述（「〜されていない」等）は禁止
- 文末は完了判定可能な動詞で記述する  
  （定義する／確定する／仕様化する／是正する／明文化する）
- 本ルールは **全フェーズ共通の拘束条件**とする

---

## 8. Backlog（F9）（更新）

以下は、**評価フェーズにそのまま投入可能な answer.md を確定させるための作業バックログ**である。

### A. 条例参照・質問意味の一意化（F9-A）

> **目的**
> 抽象的に記述された質問テンプレを、
> 条例ID・条・項がすべて確定した
> **評価可能な実行用質問へ必ず変換できる状態を成立させる。**

---

#### A-1. 質問テンプレの前提条件確定

- [ ] **質問テンプレは条例非依存である**ことを仕様として明文化する
- [ ] 質問テンプレにおいて
  **「この条例」「第○条」「第○項」等の抽象表現を許可する**ことを明記する
- [ ] 質問テンプレに
  **条例ごとに変動する値（条例ID・条・項）を直接埋め込まない**
  という制約を仕様として確定する

👉 **完了条件**：
Spec_F9-A に、質問テンプレの許容表現と禁止事項が明記されている。

---

#### A-2. 質問と条例IDの対応ルール確定

- [ ] **1つの実行単位では、1つの条例IDのみを扱う**ことを確定する
- [ ] 「この条例」という指示語は
  **必ず当該実行単位の条例IDを指す**と定義する
- [ ] 質問テンプレと条例IDの対応は
  **実行時に 1:1 に解決される**ことを明文化する

👉 **完了条件**：
「この条例」が曖昧なまま残るケースが仕様上存在しない。

---

#### A-3. 条・項探索と構造確認ルール確定（統合）

- [ ] 条・項探索は
  **条例データ（職員が保有する一次資料）を唯一の根拠とする**
- [ ] 条番号および項番号を
  **構造的に列挙・確認できる前提**を定義する
- [ ]

  - 「第○条のみ指定」
  - 「第○条第○項指定」
    の **両ケースを扱える**ことを仕様として明文化する
- [ ] 条・項の探索は
  **構造的事実の確認であり、意味解釈ではない**ことを明記する

👉 **完了条件**：
F9-A が条・項を構造的に探索・確定できる前提が仕様上明確になっている。

---

#### A-4. 解決保証ポリシーの確定（重要）

- [ ] 条・項を
  **未解決のまま後続フェーズへ渡すことを禁止**する
- [ ] 自動探索で条・項を確定できない場合、
  **ユーザー（職員）に条・項の直接入力を促す**ことを許可する
- [ ] ユーザー入力を含め、
  **何らかの方法で必ず条・項を確定させる**
  という原則を仕様として明文化する
- [ ] ユーザー入力によって得られた条・項は、
  **条例バインディングとして確定・保存される**ことを明記する

👉 **完了条件**：
「解決不能で止まる」状態が仕様上存在しない。

---

#### A-5. 条例バインディング生成条件確定

- [ ] 条例バインディングには
  **解決済みの条例ID・条・項のみを記録する**
- [ ] null / 未定義値を
  **条例バインディングとして出力しない**ことを明記する
- [ ] 条例バインディングは
  **後続フェーズの入力としてそのまま使用可能**であることを確認する

👉 **完了条件**：
F9-B / F9-D が条例バインディングを再解釈せずに利用できる。

---

#### A-6. 実行用質問生成条件確定

- [ ] 質問テンプレと条例バインディングから
  **実行用質問が機械的に生成できる**ことを定義する
- [ ] 実行用質問には
  **抽象表現が一切残らない**ことを保証する
- [ ] 実行用質問は
  **answer.md / dataset に記録される唯一の質問表現**であることを明記する

👉 **完了条件**：
評価対象となる質問文が常に一意に確定する。

---

#### A-7. 完了判定の明文化

- [ ] A-1〜A-6 がすべて満たされた場合、
  **Backlog A は完了と判定できる**ことを明文化する
- [ ] 完了判定は
  **実装有無ではなく仕様充足で判断する**ことを確認する

👉 **完了条件**：
Backlog A の完了可否を誰が見ても判断できる。

---

※ Backlog A は **F9-A 着手状態**として位置づけ維持。

### B. 実行条件の固定（HTML / Markdown / ナレッジ切替）

- [x] ナレッジ切替をアカウント差分で行う方式を定義する
- [x] 再投入方式を禁止する設計原則を確定する
- [x] 実行条件差分をアカウント差分に集約する
- [x] `.env` 切替機構を F9 正式実装対象として確定する
- [x] F4 実証結果を設計根拠として明文化する

※ Spec_F9-B_Execution_Conditions_Freeze_v0.1r に統合済み

---

### C. Extracted の正本化

- [x] Extracted を評価入力の正本と定義する
- [x] Extracted を原則として取得可能とする DOM 抽出ルールを確定する
- [x] Extracted が取得できない場合の状態分類（VALID / INVALID）を定義する
- [x] Extracted の状態（VALID / INVALID）を Metadata に明示的に記録する仕様を定義する
- [x] 書式（改行・箇条書き・強調等）を保持し、再実行時に構造が破壊されない抽出方針を仕様化する

#### 完了（F9-C としてクローズ）

※ 正本：`docs/spec/Spec_F9-C_DOM_Scope_Rules_v0.2.md`

---

### D. Raw の位置づけ整理

※ 本セクションは F9-C で確定した仕様を前提とし、  
   出力条件・運用・下流連携は F9-D で最終確定する。

- [x] Raw 出力条件（VALID 時省略可 / INVALID 時必須）の最終確定
- [x] debug profile 限定運用の明文化
- [x] F4 writer / rag_entry との I/F 最終確定

※ Spec_F9-D_Raw_and_Answer_Interface_v0.1r に統合済み

---

### E. UI ノイズ・混入対策

- [x] UI ノイズ混入を仕様違反として定義

---

### F. 成果物インターフェース確定

- [x] answer.md の必須／任意セクションを確定
- [x] frontmatter 必須情報と欠落時の扱いを定義

### G. メタ情報・バージョニング

- [ ] answer.md に付与する version を semver として定義する

---

### H. archive 運用

- [ ] 新版確定時に旧版を archive に移動する運用を明文化する

---

### I. dataset 構築（F9-D）

- [x] dataset の論理単位（rag_entry 集合）を定義する
- [x] build_dataset_from_f8 の責務を設計として明文化する
- [x] build_dataset_from_f8 の最小実装を追加する
- [x] **dataset.yaml v0.2 の必須項目を確定する**
- [x] dataset サンプルを 1 件生成する
- [x] dataset 構築に対するテストケース文書を作成する
- [x] verify-diff によりコピー完全性を実証する

※ 本 Backlog は **F9-D 完了としてクローズ**。

---

### J. CLI インターフェース設計（Deferred）

- [ ] CLI 実行モデル（pip / entrypoint / script）の選択肢を整理する
- [ ] 質問セット指定方法（file / dir）を定義する
- [ ] アカウント情報指定方法（env / file）を定義する
- [ ] 出力先指定（OUTPUT_ROOT）の仕様を定義する
- [ ] 最小 CLI インターフェース案を設計文書として確定する

※ 実装は F9-D 完了後に着手する。

---

### 📌 Backlog / Deferred Decisions

- **Spec / Design ドキュメントにおける frontmatter テンプレート差分を明文化する**
  - ドキュメント増加フェーズで再検討する

---

## 9. Next Action（更新）

- **F9-A 実装着手**
- F9 Backlog A を実装単位で消化
- 必要に応じて F9-A テスト観点を整理

---

## 10. 注記（不変）

- 本 STATUS は **現在地の唯一の正本**
- CHANGELOG / Roadmap との整合をもって更新とみなす
- 回答の評価・正誤判断・品質スコアリングは一切行わない

---
