# 📘 PROJECT_STATUS v0.7.29

**— F9 完結後／テスト計画再構築・工程5（実装修正）完了記録版 —**

**Last Updated:** 2026-01-11  
**Maintainer:** Sumio Nishioka & ChatGPT (Architect Role)

---

## 0. フェーズ定義の統一（不変）

本プロジェクトのフェーズ定義は、  
**Roadmap を唯一の正本**として以下に統一する。

| フェーズ | 内容 |
| -------- | ---- |
| F1 | 設計フェーズ |
| F2 | Page Object 実装フェーズ |
| F3 | Answer Detection & テスト基盤構築フェーズ |
| F4 | RAG 入力差分影響の観測・試験データ提供フェーズ |
| F5 | CI（e2e.yml）整備フェーズ |
| F6 | LGWAN 対応フェーズ（保留） |
| F7-A | 運用準備フェーズ |
| F7-B | 制御付き実運用試行フェーズ |
| F7-C | 拡張試行フェーズ |
| **F8** | **Markdown変換検証フェーズ** |
| **F9** | **評価可能データ安定提供フェーズ** |
| **F10+** | **評価・配布・拡張検討フェーズ** |

※ F7 は A / B / C の段階構造を持つ。

---

## 1. Current Phase（現在地）

### **F9：評価可能データ安定提供フェーズ（完了）**

F9 は以下の目的をもって実施された。

- 回答内容の正誤・品質・有用性を評価しない
- UI が返す回答を意味付けせずに観測・抽出・保存する
- 実行条件差分によって評価可能データが破壊されないことを保証する
- 後続フェーズが追従可能な成果物 I/F を確定する

これらの必須要件はすべて達成されており、  
**F9 は v0.7.26 をもって完結済み**である。

※ 完結判断の正本：`docs/spec/Done_F9.md`

---

## 2. フェーズ別到達点（要約）

### F8：Markdown変換検証フェーズ（完了）

- HTML→Markdown 変換を前提とした回答収集の技術的検証が完了
- answer.md（Raw / Extracted / Metadata）の生成成立を確認
- 非評価モデルを維持したまま観測データを確保
- F9 に引き渡し可能な素材を確立

---

### F9：評価可能データ安定提供フェーズ（完了）

#### F9-A：質問セット・条例バインディング

- 抽象質問テンプレ運用モデル確立
- 条・項の自動／非自動解決フロー確定
- 一般職員向け README / FAQ による配布・実行 UX 確定
- **運用成立を確認**

#### F9-B：実行条件固定・ナレッジ切替

- 実行条件をアカウント差分に集約
- `.env` 切替方式を正式仕様として確定
- 再投入方式を禁止

#### F9-C：Extracted 正本化

- DOM スコープ規則確定
- Extracted を評価入力の正本と定義
- VALID / INVALID の状態判定を仕様化

#### F9-D：下流フェーズ整合

- Raw / answer.md / dataset I/F 最終確定
- dataset.yaml v0.2 を実体生成
- コピー完全性を実証

---

## 3. 補足更新（F9 完結後の整理）

### 初期化手順の明文化（v0.7.27 反映済）

- `.env` 不在時に pytest が完走しない事象を確認
- `.env` を正本とする初期化手順を明文化
- 冪等な初期化スクリプト `scripts/bootstrap_env.py` を追加
  - `.env` が存在する場合は何もしない
  - 存在しない場合のみ既知テンプレートから生成
  - ダミー値／未設定項目は人間に入力を促す

※ 本対応は F9 の成果物・評価方針・I/F を一切変更しない。

---

## 4. 完了宣言（Decision）

以下を正式に宣言する。

- **F9 は目的を達成し、完結した**
- 評価可能データは、安定して生成・保存・引き渡し可能な状態にある
- 初期化手順整備は F9 の再定義ではなく、F10 準備の一環である

---

## 5. Backlog（F10）（更新）

### 完了（F9 の必須要件）

- A：質問具体化・条例参照の一意化
- B：実行条件固定・ナレッジ切替
- C：Extracted 正本化
- D：Raw の位置づけ整理
- E：UI ノイズ対策
- F：成果物インターフェース確定
- I：dataset 構築・検証

→ **すべてクローズ**

---

### F10 以降に送致（Deferred）

以下は F9 の完了条件には含めず、  
**次フェーズ（F10+）で改めて検討する。**

- G：answer.md の version（semver）定義
- H：archive 運用の明文化
- J：CLI / entrypoint 設計
- frontmatter テンプレ差分整理

---

## 6. 評価・判断に関する前提（不変）

本プロジェクトでは以下を扱わない。

- 回答内容の正誤・品質・有用性の評価
- HTML / Markdown の優劣判断
- 品質スコアリング・ランキング

---

## 7. ナレッジ形式と本プロジェクトの責務境界（不変）

本プロジェクトは、**ナレッジベースに格納される原データ形式
（HTML / Markdown）の妥当性・優劣を判断しない**。

### 7.1 責務の切り分け（不変）

- **ナレッジ形式（HTML / Markdown）の設計・変換・妥当性評価**
  - 例規 HTML 変換プロジェクトの専管事項とする
- **本プロジェクト（Qommons.AI テスト自動化）**
  - ナレッジ形式を入力条件の一つとして受け入れる
  - UI が返す回答（HTML）を、
    設計どおりに観測・抽出・保存できるかのみを検証対象とする

### 7.2 本プロジェクトにおける「評価」の定義

本プロジェクトにおける評価とは、
**回答内容の正誤・品質・表現の適切性を判定することではない**。

評価対象は以下に限定される。

- submit → probe → DOM 抽出 → answer.md 生成が成立するか
- probe 例外が execution flow を破壊しないか
- DOM 構造差分や UI ノイズが存在しても、
  観測事実と証跡が失われないか
- Extracted が VALID / INVALID として一意に状態判定されるか

### 7.3 HTML / Markdown ナレッジの扱い方針

- HTML / Markdown は **比較・観測条件の一つ**として扱う
- どちらが「正しい」「望ましい」かは、
  本プロジェクトでは結論づけない
- ナレッジ形式差分によって観測された挙動は、
  **一次情報として記録し、後続プロジェクトに引き渡す**

本方針は、F8 / F9 を通じて一貫して適用される。

---

## 8. Backlog 記述ルール（不変）

本プロジェクトにおける Backlog は、
**未解決の状態ではなく、解決するための作業単位**を記述する。

- 状態記述（「〜されていない」等）は禁止
- 文末は完了判定可能な動詞で記述する  
  （定義する／確定する／仕様化する／是正する／明文化する）
- 本ルールは **全フェーズ共通の拘束条件**とする

---

## 9. テストプラン再構築計画Backlog（優先実施）

> 位置づけ
> 
> - **F10 の前提整備タスク**
> - 実装・pytest 修正より優先
> - 成果物は「判断基準（文書・表）」
> - コードは原則まだ触らない

---

### 工程0：作業前提の固定（Done / In Progress）

- [x] test_plan_v0.2.0 章立て確定
- [x] Layer モデル（Contract / Behavior / Evaluation）合意
- [x] F4 trial dataset を Layer 3 と再定義
- [x] pytest が「保証テスト専用」である方針を明文化

---

### 工程1：設計差分の可視化（最優先）

#### 🎯 目的

- 「何が変わったのか」
- 「どこで判断が必要か」
- 「どれが実装修正タスクか」

を **章単位で可視化**する。

---

#### ✅ 作業チェックリスト

- [x] **v0.1.1 ↔ v0.2.0 章別差分レビュー表を作成する**
  - 章ごとに以下を記載：
    - v0.1.1 の主張
    - v0.2.0 の主張
    - 差分の種類（思想変更 / 書き漏れ / 実装不整合）
    - 対応方針（文書修正 / 実装修正 / 何もしない）
- [x] 差分を **A/B/C（設計変更 / 文書不備 / 実装ズレ）**で分類
- [x] 「判断が必要な差分」にフラグを立てる（即断しない）

- 差分レビュー表は、
  **後続工程（再配置・棚卸し・実装修正）の
  判断単位に分解されることを前提とする**

📌 **この工程ではコード修正は禁止**
📌 判断の棚卸しだけ行う

#### ✅ 工程1 完了宣言（記録用）

- v0.1.1 ↔ v0.2.0 の**章別差分レビュー表**作成・合意済み
- 差分は **A（設計変更）中心**で整理済み
- 判断保留の洗い出し完了
- 「pytest＝保証専用」「F4＝評価成果物」の再定義を確定

👉 **成果物**：章別差分レビュー表（設計判断の正本）

---

### 工程2：F4 / Gate / pytest の再配置設計

#### 🎯 目的

- テストの責務を「戻れない形」で確定させる

---

#### ✅ 作業チェックリスト

- [x] **F4 trial dataset の正式な引退宣言（文書）**
  - test_plan_v0.2.0 第6章（Layer 3）に明示（6.5）
- [x] F4 / Gate / Smoke の **再配置指針を文章化**
  - test_plan_v0.2.0 4.5 にて設計拘束力を明示（4.5.6）
- [x] 「pytest から除外されるもの」の明確化
- [X] Evaluation Artifacts の保存・利用方針を定義

#### 📌 工程2の完了宣言（設計確定）

本工程において、  
F4 / Gate / pytest に関する再配置の設計判断は確定した。

チェックリスト上で未記載となっている項目についても、  
Layer 3 の定義（第6章）および再配置指針（4.5）に内包されており、  
新たな設計判断を要する未決事項は残っていない。

以上より、工程2は  
**設計確定工程として完了扱いとする。**

※ 本宣言は設計判断の完了を示すものであり、  
pytest 実装修正の完了を意味しない。

---

### 工程3：既存テストの棚卸し（事実確認）

#### 🎯 目的

- 現状を **感覚ではなく表で把握**する

---

#### ✅ 作業チェックリスト

- [x] 既存テストを一覧化
- [x] 各テストを Layer 別に分類
  - ✔ 継続
  - ✖ 廃止
  - → 移動
- [x] 再配置マップ（旧 → 新）を作成
- [x] 「削除しても影響しない」ものを明示

📌 ここでもコードはまだ触らない

---

#### 📌 工程3の完了宣言（事実確定）

本工程において、
`tests/` 配下に存在するすべての pytest テストについて、

- 存在確認
- 対応する設計上の分類（Layer）
- 継続・廃止・再配置の扱い

が **実ファイル単位で確定**した。

これにより、
「どのテストが、なぜ残り／なぜ消え／どこへ移るのか」は
**付録B（設計正本）および付録C（実装対応正本）によって説明可能な状態**となった。

以上をもって、
工程3は **事実確認工程として完了**とする。

※ 本完了宣言は、
テストコードの修正・削除・移動の実施を意味しない。
それらは次工程において、
本工程で確定した判断に基づいて行われる。

---

### 工程4：設計と実装の差分確定（完了）

#### 工程4の目的（再掲）

- 設計と実装の差分を **事実として洗い出す**
- 修正すべき差分と、**修正しない判断**を混同しない
- 「直さない」という判断も **設計根拠付きで残す**

#### 🔒 工程4の前提条件（重要）

本工程は、以下が **すでに確定していること**を前提とする。

- test_plan_v0.2.0 が **設計正本として確定**している
- 工程3において、既存テストの棚卸し・再配置判断が完了している
- 「どうあるべきか」はすでに決まっており、
  本工程では **新たな設計判断は原則行わない**

この工程の役割は、
**設計と実装のズレを事実として洗い出すこと**であり、
設計そのものを再議論することではない。

---

#### ✅ 作業チェックリスト（工程4）

- [x] **test_plan_v0.2.0 と実コードの差分洗い出し**
  - 差分は以下の観点で整理する：
    - 設計どおり実装されていないもの
    - 設計以上のことをしているもの
    - 設計に存在しない責務を担っているもの

- [x] **修正対象をタスク化（pytest / マーカー / 配置）**
  - 各差分について：
    - なぜ修正が必要か（設計根拠）
    - 何を変えるか（最小単位）
    - どこを触るか（ファイル単位）
      を明示する

- [x] **修正不要なものを「意図どおり」と明示**
  - 一見ズレて見えるが、設計上問題ないもの
  - 将来工程で扱うため、今回は触らないもの
  - あえて残している暫定実装

📌 この工程では **まだコードは変更しない**
📌 diff は「作業ログ」ではなく **判断ログ**として残す

#### 実施内容（事実）

- `tests/` 配下の **全 pytest テストファイル**について、
  - 設計根拠の特定
  - test_plan_v0.2.0 との整合確認
  - A / B / C 判定（設計一致／将来修正対象／非修正）
  を **ファイル単位で実施**
- 判定結果は **工程5レビュー（5.x）として文書化**
- B / C 判定についても、  
  **「なぜ今は直さないか」を設計に基づいて明示**

#### 📌 工程4の出口条件（ここを満たしたら次へ）

- すべての差分が、以下いずれかに分類されていること：
  - 修正が必要（理由付き）
  - 修正不要（設計に照らして妥当）
  - 今回は扱わない（理由明示）
- 「なぜその修正をするのか」を  
  test_plan_v0.2.0 を参照して説明できる状態であること

#### 工程4 完了条件の達成状況

以下の完了条件はすべて満たされている。

- 全 test file の判断が **A / B / C で確定**
- 「直さない判断（B / C）」が **設計根拠付きで記録**
- 判断はすべて test_plan_v0.2.0 を参照して説明可能

以上より、  
**工程4（設計と実装の差分確定）は完了とする。**

---

### 工程5：実装修正・反映（完了）

#### 🎯 目的

- 工程4で確定した設計判断を、実装に反映する
- pytest の責務を「契約・成立・非例外確認」に揃える
- テスト計画再構築を完結させ、本フェーズへ復帰する

---

#### ✅ 作業チェックリスト（工程5）

- [x] pytest マーカー付け替え
- [x] F4 trial dataset の pytest 完全除去
- [x] 不要テスト（legacy ask 系）の削除
- [x] F4 writer / RAG v0.1 テストの縮退（評価 assert 除去）
- [x] CHANGELOG 更新
- [x] PROJECT_STATUS 更新

---

#### 📌 工程5 完了宣言

本工程において、

- pytest が意味評価・品質評価を一切行わないこと
- pytest が契約・成立確認に専念していること
- 新端末・CI 環境差によって pytest が不安定化しないこと

が **実装レベルで確認された**。

以上より、  
**工程5（実装修正・反映）は完了**とする。

本プロジェクトは、  
**テスト計画再構築Backlogから離脱し、通常の開発・検証フェーズ（F10+）へ復帰する。**

---

## 10. Backlog（F10 以降）

**目的**
ゴールデン質問・ゴールデン条例を用い、
例規HTML変換プロジェクトへ引き渡す
**評価可能な answer.md 本番セット**を生成・確定する。

### Backlog（案）

- [X] ゴールデン質問セットを **本番生成用として凍結宣言**する
- [X] ゴールデン条例（HTML / Markdown）の **投入条件と識別方法を明文化**する
- [x] 本番 run の **実行条件（環境・アカウント・手順）を固定**する
- [ ] ゴールデン質問 × ゴールデン条例による **answer.md を全件生成**する
- [ ] 生成された answer.md 一式を **引き渡し用成果物として束ねる**
- [ ] 本成果物が **評価判断を含まない入力データであることを明記**する

**完了条件（判定基準）**

- 第三者がそのまま評価入力として利用できる answer.md 一式が存在する
- 本プロジェクト側での再解釈・評価・加工を行っていないことが説明できる

---

## F10-B：リポジトリ全体の最適化（構造・責務整理）

**目的**
F9 完結後の現状に合わせ、
リポジトリ構造と責務配置を **説明可能な状態に整理**する。

### Backlog（案）

- [ ] run/ ディレクトリの責務を **F10 時点の位置づけとして再定義**する
- [ ] scripts/ 配下のファイルを **正式資産／暫定資産／廃棄候補に仕分け**する
- [ ] 一時的・検証用コードを **正式資産と明確に分離**する
- [ ] ディレクトリ構造が **Roadmap / PROJECT_STATUS の責務と一致していることを確認**する
- [ ] 不要な重複・死蔵ファイルを **履歴を残した上で整理**する

**完了条件**

- 「このリポジトリには何があり、何のために存在するか」を説明できる
- F9 成果物の意味・I/F が一切変わっていない

---

## F10-C：ドキュメント整理・統合（入口と正本の明確化）

**目的**
ドキュメント体系を整理し、
**第三者が迷わず F9 成果を理解できる状態**を作る。

### Backlog（案）

- [ ] README 系ドキュメントの **役割分担（入口／手引き／仕様）を整理**する
- [ ] Spec / Design / HowTo の **正本・補助文書の関係を明示**する
- [ ] 重複・分散している説明を **統合または参照関係に整理**する
- [ ] F9 完結および F10 開始の **文脈が文書上で追える状態にする**
- [ ] 「本プロジェクトがやらないこと」を **明示的に残す**

**完了条件**

- 初見の利用者が README から F9 成果の位置づけを理解できる
- 設計判断の正本がどれか一目で分かる

---

## F10-D：積み残し Backlog の再評価と消化

**目的**
F9 から Deferred された項目について、
**必要性を再判断した上で処理する**。

### Backlog（案）

- [ ] answer.md の version（semver）付与要否を **再評価し結論を出す**
- [ ] archive 運用（旧版退避ルール）を **必要十分な形で定義する**
- [ ] CLI / entrypoint 設計の **実施可否を判断する**
- [ ] frontmatter テンプレ差分の扱いを **設計判断として確定する**
- [ ] 不要と判断した項目を **明示的に Backlog からクローズ**する

**完了条件**

- Deferred 項目が「未整理」ではなく
  **やる／やらない／後続に送るの判断済み状態**になる

---

## 補足（重要）

- **F10-A が唯一の“成果物生成フェーズ”**
- F10-B/C/D はすべて
  👉 *F10-A を安全に成立させるための整理フェーズ*
- 同時並行はせず、**A → B/C → D** の順が安全

---

## 11. Next Action（更新）

- 工程5完了をもって、テスト計画再構築計画はクローズ
- F10-A（成果物生成フェーズ）の実施判断・着手準備を行う

---

## 12. 注記（不変）

- 本 STATUS は **現在地の唯一の正本**
- CHANGELOG と整合していることをもって有効とする
- 設計判断なき実装修正は行わない
