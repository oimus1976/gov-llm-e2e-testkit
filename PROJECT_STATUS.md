# 📘 PROJECT_STATUS v0.7.10

**— F9-C 完了（Extracted 正本化 / Raw Anchor 一本化）反映版 —**

**Last Updated:** 2025-12-29
**Maintainer:** Sumio Nishioka & ChatGPT (Architect Role)

---

## 0. フェーズ定義の統一（不変）

本プロジェクトのフェーズ定義は、  
**Roadmap を唯一の正本**として以下に統一する。

|フェーズ|内容|
|------|------|
|F1|設計フェーズ|
|F2|Page Object 実装フェーズ|
|F3|Answer Detection & テスト基盤構築フェーズ|
|F4|RAG 入力差分影響の観測・試験データ提供フェーズ|
|F5|CI（e2e.yml）整備フェーズ|
|F6|LGWAN 対応フェーズ（保留）|
|F7-A|運用準備フェーズ|
|F7-B|制御付き実運用試行フェーズ|
|F7-C|拡張試行フェーズ|
|**F8**|**Markdown変換検証フェーズ**|
|**F9**|**評価可能データ安定提供フェーズ**|

※ F7 は単一フェーズではなく、A / B / C の段階構造を持つ。

---

## 1. Current Phase（現在地）

### **F8：Markdown変換検証フェーズ（完了）**

- HTML→Markdown 変換を前提とした回答収集が技術的に成立
- 全質問について answer.md（Raw / Extracted / Metadata）が必ず生成されることを確認
- 回答の評価・優劣判断を行わない非評価モデルを維持したまま、  
  **次フェーズに引き渡し可能な観測データ一式を確保**
- F8 における責務は **すべて完了**

### **F9：評価可能データ安定提供フェーズ（進行中）**

- Roadmap v1.5 にて正式フェーズとして新設
- F8 成果物を対象に、  
  **評価を行わずに「評価可能な状態」を安定的に提供するための整理・是正フェーズ**
- answer.md を **評価入力として完成形に確定**することを目的とする
- 回答の評価・採点・品質判断は **一切行わない**

#### **F9-C：Extracted 正本化（完了）**

- DOM スコープ規則を仕様として確定
- Extracted を評価入力の正本と定義
- Raw / Extracted の起点 DOM を単一 Anchor に統一
- 空欄成功・暗黙前提を排除し、
  **Extracted 不取得時は必ず INVALID と判定する安全設計を確立**

※ 完了判定は  
`docs/spec/Spec_F9-C_DOM_Scope_Rules_v0.2.md` を正本として行う。

---

## 2. ドキュメント構造整理（v0.7.6 反映事項・不変）

### 概要

- docs 配下のディレクトリ構造を整理し、  
  **入口文書／設計／運用／規約／アーカイブの責務を明確化**
- **内容・設計意味論の変更は一切行っていない**
- move-only による整理を実施

### 正本配置ルール（確定）

- **リポジトリ直下**
  - README.md
  - CHANGELOG.md
  - PROJECT_STATUS.md
- **docs 直下（不変・横断ルール）**
  - PROJECT_GRAND_RULES.md
  - Debugging_Principles.md
  - Roadmap.md
- **docs 配下**
  - design / operation / protocol / runbook / guidelines / spec / test_plan
- **docs/archive**
  - 旧版設計
  - 思考過程・検討メモ
  - 完了済みフェーズ成果物

この構造は **README.md に正式反映済み**。

---

## 3. プロジェクトの到達点（更新）

本プロジェクトは現在、以下が **同一 main ブランチ上で整合した状態**に到達している。

- 再現可能な E2E テスト基盤（F1–F3）
- RAG 入力差分影響の試行データ生成（F4）
- 基盤破壊を検知する最小 CI（F5）
- 制御付き実運用試行（F7-C）
- **回答素材収集基盤としての F8 技術成立**
- **F9 着手に必要な Backlog・運用ルールの確定**
- **F9-C（Extracted 正本化）における DOM スコープ規則の仕様確定**
- **Raw capture を Anchor DOM 一本化し、最悪ケース（空欄成功）を構造的に排除**

---

## 4. 完了済み成果（更新）

### ✅ F8：Markdown変換検証フェーズ

- DOM-based Answer 抽出ロジックの確定
- answer.md 生成構造（Raw / Extracted / Metadata）の成立
- 非評価・観測モデルの実装完了

### ✅ F9-C：Extracted 正本化フェーズ（新規完了）

- Extracted を評価入力の正本として確定
- DOM スコープ規則を仕様（Spec v0.2）として確定
- Raw / Extracted の起点 DOM を完全一致させる設計を確立
- Extracted 不取得時に INVALID と判定する安全設計を実装
- Raw を **デバッグ／再現確認専用の補助成果物**として再定義

---

## 5. 評価・判断に関する前提（不変）

以下は **本プロジェクトでは扱わない**。

- 回答の正誤・品質・有用性の評価
- HTML / Markdown の優劣判断（ナレッジ形式の是非判定）
- 品質スコアリング・ランキング

これらは **後続プロジェクトで扱う前提**とする。

---

## 6. ナレッジ形式と本プロジェクトの責務境界（不変）

本プロジェクトは、**ナレッジベースに格納される原データ形式
（HTML / Markdown）の妥当性・優劣を判断しない**。

### 6.1 責務の切り分け（不変）

- **ナレッジ形式（HTML / Markdown）の設計・変換・妥当性評価**
  - 例規 HTML 変換プロジェクトの専管事項とする
- **本プロジェクト（Qommons.AI テスト自動化）**
  - ナレッジ形式を入力条件の一つとして受け入れる
  - UI が返す回答（HTML）を、
    設計どおりに観測・抽出・保存できるかのみを検証対象とする

### 6.2 本プロジェクトにおける「評価」の定義

本プロジェクトにおける評価とは、
**回答内容の正誤・品質・表現の適切性を判定することではない**。

評価対象は以下に限定される。

- submit → probe → DOM 抽出 → answer.md 生成が成立するか
- probe 例外が execution flow を破壊しないか
- DOM 構造差分や UI ノイズが存在しても、
  観測事実と証跡が失われないか
- Extracted が VALID / INVALID として一意に状態判定されるか

### 6.3 HTML / Markdown ナレッジの扱い方針

- HTML / Markdown は **比較・観測条件の一つ**として扱う
- どちらが「正しい」「望ましい」かは、
  本プロジェクトでは結論づけない
- ナレッジ形式差分によって観測された挙動は、
  **一次情報として記録し、後続プロジェクトに引き渡す**

本方針は、F8 / F9 を通じて一貫して適用される。

---

## 7. Backlog 記述ルール（不変）

本プロジェクトにおける Backlog は、
**未解決の状態ではなく、解決するための作業単位**を記述する。

- 状態記述（「〜されていない」等）は禁止
- 文末は完了判定可能な動詞で記述する  
  （定義する／確定する／仕様化する／是正する／明文化する）
- 本ルールは **全フェーズ共通の拘束条件**とする

---

## 8. Backlog（F9：評価可能データ安定提供フェーズ）（更新）

以下は、**評価フェーズにそのまま投入可能な answer.md を確定させるための作業バックログ**である。

### A. 条例参照・質問意味の一意化

- [ ] 質問文と条例 ID を 1:1 で対応づけるルールを定義する
- [ ] 指示語（この条例 等）を条例 ID に機械的に解決する仕組みを仕様化する
- [ ] 条文参照（第○条 等）を条例構造と突合する前提条件を明文化する

### B. 実行条件の固定（HTML / Markdown）

- [ ] 差分要因を **アカウントのみ**に限定する条件を明文化する
- [ ] 出力ディレクトリ構造を profile 別比較前提として確定する

### C. Extracted の正本化（最重要）

- [x] Extracted を評価入力の正本と定義する
- [x] Extracted を原則として取得可能とする DOM 抽出ルールを確定する
- [x] Extracted が取得できない場合の状態分類（VALID / INVALID）を定義する
- [x] Extracted の状態（VALID / INVALID）を Metadata に明示的に記録する仕様を定義する
- [x] 書式（改行・箇条書き・強調等）を保持し、再実行時に構造が破壊されない抽出方針を仕様化する

#### 完了（F9-C としてクローズ）

※ 正本：`docs/spec/Spec_F9-C_DOM_Scope_Rules_v0.2.md`

---

### D. Raw の位置づけ整理

- [ ] **Answer (Raw)** を  
  「UI 全体ダンプ」ではなく、  
  **UI 上で“回答として提示された DOM スコープ”から取得した  
  *HTML 非変換*の Raw データ**  
  と定義する
- [ ] Raw は **HTML → Markdown 等の意味的変換を一切行わず**、  
  DOM に存在した構造・タグ・順序を保持したまま保存することを明記する
- [ ] Raw 取得時に、サイドバー・操作説明・ナビゲーション等の  
  **回答とは無関係な UI 補助要素を除外する DOM 抽出仕様を定義する**
- [ ] Raw と Extracted は  
  **同一の起点 DOM スコープ（例：`.message-received:last`）を共有する**  
  ことを原則とし、比較可能性を担保する
- [ ] Raw は **回答の正誤・品質・有用性の評価には使用しない**ことを明記する
- [ ] Raw を **デバッグ・検証・再現確認のための補助成果物**と位置づけ、  
  評価用途から除外する
- [ ] **Answer (Extracted) が VALID の場合**、  
  Raw の出力を **省略可能**とする運用ルールを定義する
- [ ] **Answer (Extracted) が INVALID の場合**、  
  **原因分析・再現確認のため Raw を必ず出力する**仕様を定義する
- [ ] Raw 出力を **debug profile のみに限定する**
- [ ] Raw の出力条件・debug profile 限定運用を最終確定する
- [ ] 下流フェーズ（F4）とのインターフェースを明文化する

---

### E. UI ノイズ・混入対策

- [ ] UI 補助要素を除外する DOM 抽出仕様を確し、混入時は仕様違反として扱う

### F. 成果物インターフェース確定

- [ ] answer.md の必須／任意セクションを確定する
- [ ] frontmatter の必須項目と欠落時の扱いを定義する

### G. メタ情報・バージョニング

- [ ] answer.md に付与する version を semver として定義する

### H. archive 運用

- [ ] 新版確定時に旧版を archive に移動する運用を明文化する

### 📌 Backlog / Deferred Decisions

- **Spec / Design ドキュメントにおける frontmatter テンプレート差分を明文化する**
  - F9-C では実施しない
  - ドキュメント増加フェーズで再検討する

---

## 9. Next Action（更新）

- **F9-D：下流フェーズ整合（追従修正）に着手**
  - rag_entry / F4 writer を新 Raw 仕様に追従させる
  - CI / Playwright 環境要因は F5 として切り分ける
- F9 Backlog（D 以降）を順次解決する

---

## 10. 注記（不変）

- 本 STATUS は **現在地の唯一の正本**
- CHANGELOG / Roadmap との整合をもって更新とみなす
- F8 / F9 を通じて、  
  **回答の評価・正誤判断・品質スコアリングは一切行わない**

---

## 付記：v0.7.10 の位置づけ（更新）

- **F9-C（Extracted 正本化）を完了と宣言した区切りバージョン**
- DOM スコープ規則・Raw/Extracted 関係が仕様・実装・検証で整合
- 下流フェーズ（F4/F9-D）への影響を意図的に切り出したスナップショット
- **設計的に後戻りしない状態を確定したマイルストーン**

---
