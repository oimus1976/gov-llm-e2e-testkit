# gov-llm-e2e-testkit

自治体向け LLM / RAG サービス（例：チャットUI）に対して、**Playwright（Python）で E2E（UI経由）実行を再現可能にし、観測ログを収集するためのテストキット**です。

- 目的：**品質の“判定”ではなく、壊れた／壊れていないを説明できる一次情報（ログ・DOM・成果物）を取ること**
- 想定：条例・規程などのナレッジを用いた QA（質問→回答）を、手動運用や閉域運用も視野に入れて実行する
- 性格：**非公式／実験的（研究・運用検証用途）**のリポジトリです

---

## このリポジトリが提供するもの

- **E2E 実行基盤**（Python + Playwright）
  - ログイン → チャット送信 → 回答待ち → 回答素材の回収
- **観測のための成果物出力（ログ生成）**
  - 実行条件・観測事実・DOM由来の回答素材をファイルとして残す
- **フェーズ別の運用・設計ドキュメント**
  - 何を目的に、どこまでを責務とし、何をしないか（Non-Goals）を明文化

---

## Non-Goals（このリポジトリで “やらない” こと）

このプロジェクトは、意図的に以下を対象外にします。

- **回答の評価（正確性・有用性・優劣・採点）**
- LLM の性能比較、モデルランキング
- 回答を「良くする」ための最適化（リトライ、プロンプト修正、ヒューリスティック改善）
- UI / DOM を契約化すること（UIは変わる前提）
- ナレッジの自動アップロード／削除（運用・別責務）

> **重要**：回答評価は別プロジェクト（例：例規HTML変換プロジェクト側）で行う前提です。  
> 本リポジトリは **“評価に使える材料（一次ログ）生成” に徹します。**

---

## 想定読者

- 将来の自分（運用・保守・再現をしたい）
- 同種の E2E 検証基盤を検討する第三者（OSSとして読む人）

---

## クイックナビ（どこを見ればいいか）

### 設計（責務・境界を理解したい人）

- F8 runner / orchestrator（最新・正式）
  - `docs/design/Design_F8_v0.3.1_runner.md`
- 単一質問実行 I/F（実行エンジンの最小単位）
  - `docs/design/Design_F8_AutoQuestion_Execution_v0.1.md`

### 実行手順（実際に回す人・最重要）

- **F8-Set-1 実務手順（正本）**
  - `docs/operation/F8-Set-1_Procedure_v1.0.md`

> ⚠️ 注意  
> README は概要説明のみです。  
> **実行手順・禁止事項・成果物の正しい扱いは、必ず上記実務手順を正本として参照してください。**

### 実行スクリプト（入口）

- `scripts/`
  - フェーズごとに用途が異なります（詳細は実務手順参照）

---

## フェーズの考え方（このリポジトリの読み方）

このリポジトリは、フェーズ（例：F4 / F8）により **入口・成果物・責務**が変わります。  
「今はどのフェーズか」を前提に読むことが重要です。

- **F4**
  入力差分影響の観測・試験データ提供  
  （HTML / Markdown などの差分を *判断に使える形で* 記録する）

- **F8**
  Markdown 価値判断のための材料生成  
  （質問を回し切り、回答素材を **評価抜きで** 取り切る）

※ 最新のフェーズ定義は Roadmap / PROJECT_STATUS を正本とします。

---

## F8（回答素材収集フェーズ）の概要

F8 は「回答を評価する」フェーズではなく、  
**後工程（例規HTML変換プロジェクト等）が判断できる材料を最大限回収するフェーズ**です。

### F8 の成果物（例：answer.md）

- 各質問について **必ず 1 レコード**を生成する（成功・失敗いずれでも）
- `answer.md` は **正本（後工程に渡す一次ログ）**
- 取得は **UI DOM ベースの best-effort**
- **Extracted / Raw を分離**し、責務を混ぜない
- 回答内容の良否・正確性は **一切判断しない**

---

## F8 の主な構成

- **コア（正式・非実行）**
  - `src/execution/f8_orchestrator.py`
    - F8 フェーズの orchestrator（制御のみ）
    - 単独 CLI ではなく、ドライバから呼び出される前提
- **単一質問実行（実行エンジン）**
  - `src/execution/run_single_question.py`
    - 1問＝1成果物を生成する最小実行単位
- **DOM 抽出（回答素材回収）**
  - `src/execution/answer_dom_extractor.py`
    - UI DOM からの best-effort 抽出（評価・整形はしない）
- **実行入口（手動検証用）**
  - `scripts/run_f8_set1_manual.py`
    - Playwright が動作する環境で人が直接実行する検証用スクリプト

---

## 実行方法（最小）

- 手動検証（F8 runtime 検証）
  - `scripts/run_f8_set1_manual.py` を使用

実行に必要な設定（認証情報、対象環境、禁止事項）は
**必ず** `docs/operation/F8-Set-1_Procedure_v1.0.md` を参照してください。

---

## 成果物の取り扱い（重要）

- 成果物は「評価結果」ではなく **観測ログ（一次情報）**です
- 上書き・差し替えは行いません（再現性確保のため）
- 回答の良否・正確性は、このリポジトリでは判断しません

---

## Versioning（バージョン表記について）

本プロジェクトでは、設計・運用の意思決定を追跡するため  
ドキュメント群をバージョン付きで管理します。

- 変更履歴：`CHANGELOG.md`
- 現在地：`PROJECT_STATUS.md`

※ `r` / `+` などの表記の意味論は
F8 クロージング作業の一環として README / docs 側に明文化予定です。

---

## Contributing

Issue / PR は歓迎しますが、本リポジトリは  
**フェーズと責務境界が厳密**なプロジェクトです。

- 変更前に該当フェーズの設計（`docs/design/Design_*.md`）を確認してください
- ロジック変更を伴う場合は、設計方針の提示を必須とします

---

## License / Disclaimer

- 本プロジェクトは非公式のテストキットです
- 特定ベンダー／特定サービスの動作保証は行いません
- 本ツールの利用により生じたいかなる損害についても責任を負いません

（LICENSE の明示は別途対応してください）

---
