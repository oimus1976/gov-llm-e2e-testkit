---
title: Design_rag_f4_operation_rules_v0.1
project: gov-llm-e2e-testkit
phase: F4 (RAG Evaluation)
status: Approved (Operational Rule)
date: 2025-12-14
---

# F4 RAG 評価フェーズ 運用ルール v0.1

## 0. Purpose（本書の目的）

本書は、F4 フェーズにおける
**HTML vs Markdown 差分評価を「評価可能な状態」で実施するための運用前提**
を固定することを目的とする。

本ルールは、コード設計ではなく **評価の信頼性を担保するための境界定義**であり、
F4 v0.1 が終了するまで変更しない。

---

## 1. Authority（位置づけ）

- 本ルールは以下の設計書に優先する「運用上の前提条件」を定める。
  - Design_rag_f4_eval_v0.1
  - Design_pytest_f4_results_writer_v0.1
- 本ルールに反する実験結果は **F4評価として採用しない**。

---

## 2. F4 v0.1 の評価スコープ（再確認）

F4 v0.1 の目的は以下に限定される。

> **同一質問・同一条件下で、
> ナレッジ形式（HTML / Markdown）の違いが
> RAG回答に与える影響を差分として観測すること**

### 明示的にやらないこと

- 絶対評価
- 良否判定
- モデル比較
- 意味的同義語判定
- ノイズ耐性評価

---

## 3. アカウント・プロファイル運用ルール（最重要）

### 3.1 アカウント分離を必須とする

F4 v0.1 では、以下の **2アカウント分離**を必須とする。

| 用途 | 内容 |
|---|---|
| HTML用 | HTML形式ナレッジのみを投入したテストアカウント |
| Markdown用 | Markdown形式ナレッジのみを投入したテストアカウント |

#### 理由

- ナレッジ削除後のインデックス残留を否定できない
- embedding / cache 混在を完全に排除できない
- 差分評価の主変数（ナレッジ形式）を汚染しないため

---

### 3.2 env.yaml による profile 切替

pytest 実行時は、必ず profile を明示的に切り替える。

```yaml
profile: html
````

```yaml
profile: markdown
```

※ 認証情報・接続先が異なることを前提とする。

---

## 4. ナレッジ投入ルール（Case 単位）

### 4.1 Case ごとに単独ナレッジ投入

F4 v0.1 では、**1 Case = 1 条例ファイル**を厳守する。

| Case   | ナレッジ状態 |
| ------ | ------ |
| Case 1 | 条例Aのみ  |
| Case 2 | 条例Bのみ  |
| Case 3 | 条例Cのみ  |

#### 禁止事項

* Case1 の条例を残したまま Case2 を実行
* 複数条例を同時に投入した状態での評価

#### 理由

* 質問文の曖昧性が増大する
* 評価対象が「ナレッジ形式」から「検索曖昧性」にすり替わる

---

## 5. 質問文の固定ルール

### 5.1 質問文は HTML / Markdown 間で完全一致とする

* 改行
* 表記揺れ
* 言い換え

を含め、**1文字でも異なる質問は禁止**。

#### 理由

* LLM 非決定性の増大
* 差分原因の特定不能化

---

## 6. 自動化範囲の明確化

### 6.1 pytest が担う責務

* 質問送信（ChatPage.submit）
* Answer Detection（probe）
* Evidence 抽出
* F4 結果ログ（Markdown）生成

---

### 6.2 人手運用を許容する範囲

F4 v0.1 では、以下を **意図的に自動化しない**。

* プライベートナレッジ管理画面操作
* ナレッジのアップロード／削除
* 管理UIの DOM 操作

#### 理由

* 評価基盤の責務逸脱を防ぐ
* UI変更耐性を保つ
* F4 v0.1 を過度に重くしない

---

## 7. 実行順序（固定）

1. HTML 用アカウントで Case 実行
2. F4 結果ログ生成（HTML）
3. Markdown 用アカウントで **同一 Case / 同一質問** 実行
4. F4 結果ログ生成（Markdown）
5. 差分は **人手で観測記録**（v0.1）

---

## 8. F4 v0.2 への持ち越し事項（参考）

以下は v0.1 では扱わず、次フェーズで検討する。

* 複数条例同時投入（ノイズ耐性）
* ナレッジ管理の自動化
* Stability（N>3）の自動集計
* Hallucination 検出の拡張

---

## 9. Conclusion（固定宣言）

本運用ルール v0.1 により、

* HTML vs Markdown の差分評価における
* **評価条件・主変数・非主変数が明確化された**

F4 v0.1 の実験結果は、
**本ルールを満たした場合のみ有効**とする。

---

以上。

---
