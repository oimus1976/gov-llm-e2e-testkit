# Question Resolution Tool — 利用手引書

## はじめに

本ツールは、
**条例データと質問テンプレートをもとに、実行用の質問文を機械的に確定・生成する**
ためのユーティリティです。

本ツールには、

- 生成AIへの問い合わせ
- 回答の収集
- 回答内容の正誤や品質評価

といった機能は **ありません**。

あくまで、

> 「どの条例に対して、どのような質問文を投げるか」

を **再現可能な形で確定させる** ことのみを目的とします。

本ツールは、自治体職員など、  
**条例データを用いた質問定義を行う担当者**の利用を想定しています。

---

## 本ツールの位置づけ

本ツールは、プロジェクト全体における以下の流れの **一部**を担います。

1. **質問具体化（本ツール / F9-A）**
2. 回答収集（別フェーズ）
3. 回答評価・検証（別フェーズ）

そのため、本ツール単体では **回答結果は得られません**。  
生成されるのは、後続フェーズで使用するための **質問定義データ**です。

本ツールは、プロジェクト全体における  
「質問具体化フェーズ」の入口にあたります。

本ツールで生成された質問定義データは、  
次フェーズである「回答収集フェーズ」に引き渡され、  
生成AIサービスへの問い合わせに使用されます。

---

## 前提と注意事項

- 本ツールは **非対話型**です  
  実行時に入力を求められることはありません。
- 入力ファイルの **場所と名前は固定**されています  
  ファイル名や配置場所を変更しないでください。
- 本ツールの実行には **Python 実行環境**が必要です。
- `run/` フォルダ配下のスクリプトは **実行専用**です  
  内容を編集しないでください。

なお、生成AIサービスへの接続設定  
（URL、ユーザーID、パスワード等）は、  
本ツールでは扱いません。

これらの初期設定は、後続の（回答収集フェーズ）で  
まとめて行うことを想定しています。

---

## 第1章　ファイル構成と配置ルール

本ツールを実行する前に、以下の構成でファイルを配置してください。

```text
data/
  reiki/
    <ordinance_id>.html
  ordinance.csv
  question.csv
```

### 各ファイルの役割

- `data/reiki/`

  - 条例本文の HTML ファイルを配置します
  - ファイル名は **条例IDと同一**である必要があります
- `data/ordinance.csv`

  - 処理対象となる条例の一覧を定義します
- `data/question.csv`

  - 質問テンプレートを定義します

※ `<ordinance_id>` は、`ordinance.csv` に記載された条例IDと一致させてください。  
※ ファイル名やディレクトリ構成を変更すると、本ツールは正しく動作しません。  
※ 編集するのは **CSV ファイルの中身のみ**です。

---

## 第2章　実行方法

本ツールは、実行環境に応じて **PowerShell 版**または **bat 版**のいずれかを使用して実行します。  
通常は **PowerShell 版の利用を推奨**します。

いずれの場合も、事前に **第1章で示したファイル構成が正しく配置されていること**が前提です。

---

### 2.1 PowerShell が利用できる場合（推奨）

PowerShell が使用可能な環境では、以下のスクリプトを実行してください。

```text
run/run_question_resolution.ps1
```

このスクリプトは、

- 必要な入力ファイルの存在確認
- 固定された配置ルールに基づく処理実行

を行います。
実行中にユーザー入力を求められることはありません。

---

### 2.2 PowerShell が利用できない場合（簡易実行）

PowerShell が利用できない環境では、以下のスクリプトを実行してください。

```text
run/run_question_resolution.bat
```

このスクリプトは、Python 実行環境を前提として
固定された入力ファイルを用いて処理を実行します。

※ 実行結果やエラー内容は、そのまま画面に表示されます。
※ bat 版は簡易実行用であり、詳細な制御や補助機能は提供しません。

---

### 2.3 実行時の注意事項

- 実行前に、`data/` 配下のファイルがすべて揃っていることを確認してください
- ファイル名や配置場所を変更しないでください
- 処理中にエラーが表示された場合は、表示内容を確認のうえ入力ファイルを見直してください

実行が正常に完了すると、質問解決結果の JSON ファイルが生成されます。

生成されたファイルは、次の  
「回答収集フェーズ」の入力として使用します。  
詳細は、回答収集フェーズの手順書を参照してください。

---

## 第3章　出力内容

本ツールの実行結果は、**質問解決結果（Question Resolution Result）**として  
JSON 形式のファイルで出力されます。

出力される内容は、後続フェーズ（回答収集・評価）で使用することを前提とした  
**中間成果物**です。

---

### 3.1 出力ファイルの種類

実行結果として、以下の 2 種類のファイルが生成されます。

- **履歴ファイル**
  - 実行時刻を含むファイル名で保存されます
  - 過去の実行結果を保持するためのものです
- **最新ファイル**
  - 常に同一のファイル名で保存されます
  - 最新の実行結果のみを参照したい場合に使用します

---

### 3.2 出力ファイル名

出力ファイルは、以下の形式で生成されます。

- 履歴ファイル

  ```text
  question_resolution_result_<timestamp>.json
  ```
  
- 最新ファイル

  ```text
  question_resolution_latest.json
  ```

※ `<timestamp>` には、実行時刻（UTC）が付与されます。

---

### 3.3 出力内容の概要

出力される JSON には、主に以下の情報が含まれます。

- 入力として使用された条例情報
- 入力として使用された質問テンプレート
- 条例と質問テンプレートを組み合わせた **実行用質問文**

本ツールでは、

- 回答内容
- 回答の正誤
- 回答の品質評価

は **一切生成しません**。

---

### 3.4 出力データの扱いについて

出力された JSON は、そのまま人が読むこともできますが、
主に **後続の自動処理で利用されること**を想定しています。

必要に応じて、次フェーズのツールに入力として渡してください。

これらの出力ファイルは、本プロジェクトにおける  
「質問定義の正本」として扱われます。

内容を直接編集せず、  
後続ツールへの入力としてそのまま使用してください。

---

## 第4章　よくあるエラーと対処

本ツールのエラーは、**入力ファイルの不足や配置ミス**に起因するものが大半です。  
以下に代表的な例と対処方法を示します。

---

### 4.1 入力ファイルが見つからない

#### 表示例

```
[ERROR] 条例本文HTMLフォルダが見つかりません: data/reiki
```

#### 原因

- `data/reiki/` ディレクトリが存在しない
- ディレクトリ名を変更している

#### 対処

- 第1章の構成どおりに `data/reiki/` ディレクトリを作成してください
- ディレクトリ名を変更しないでください

---

### 4.2 条例本文HTMLが見つからない

#### 表示例

```
[ERROR] 条例本文HTMLが見つかりません: <ordinance_id>.html
```

#### 原因

- 対象となる条例IDに対応する HTML ファイルが存在しない
- ファイル名が条例IDと一致していない

#### 対処

- `data/reiki/` 配下に、条例IDと同名の HTML ファイルを配置してください
- 拡張子を含め、ファイル名が完全に一致しているか確認してください

---

### 4.3 CSV ファイルが見つからない

#### 表示例

```
[ERROR] ordinance.csv が見つかりません
```

または

```
[ERROR] question.csv が見つかりません
```

#### 原因

- `data/ordinance.csv` または `data/question.csv` が存在しない
- ファイル名を変更している

#### 対処

- 第1章の構成どおりに CSV ファイルを配置してください
- ファイル名を変更しないでください

---

### 4.4 処理中にエラーが発生した

#### 表示例

```
処理中にエラーが発生しました。
```

#### 原因

- 入力ファイルの内容に不整合がある
- CSV の形式が想定と異なる

#### 対処

- CSV の内容（列名・値）を確認してください
- 必要に応じて、サンプルファイルと差分を比較してください
- 解決しない場合は、エラーメッセージ全文を添えて管理者に相談してください

---

## 第5章　補足・注意事項

### 5.1 本ツールの対象範囲

本ツール（F9-A: Question Resolution）は、  
**質問文を機械的に確定・生成することのみ**を目的としています。

以下の処理は、本ツールの対象外です。

- 生成AIサービスへの問い合わせ
- 回答内容の収集
- 回答の正誤判定や品質評価

これらは、後続フェーズのツールで行ってください。

---

### 5.2 実行結果の再現性について

本ツールは、同一の入力ファイルを使用した場合、  
**常に同一の質問解決結果を出力**します。

- 実行環境による挙動差は想定していません
- 再現性を確保するため、入力ファイルの管理には注意してください

---

### 5.3 入力ファイルの管理について

- CSV ファイルは、**ファイル名・配置場所を固定**したうえで  
  内容のみを編集してください
- 条例本文 HTML は、対象となる条例ID分のみを配置してください
- 不要なファイルが混在していても、処理対象にはなりません

`ordinance.csv` および `question.csv` のサンプルは、  
プロジェクト内のサンプルファイルを複製して使用してください。

列名や構造は変更せず、  
値のみを編集してください。

---

### 5.4 run ディレクトリの扱い

`run/` ディレクトリ配下のスクリプトは、
**実行専用**として提供されています。

- 内容を編集しないでください
- 別の場所にコピーして実行しないでください  
  （入力ファイルの参照に失敗する可能性があります）

正しく動作しない場合は、
まずファイル配置ルールを確認してください。

---

