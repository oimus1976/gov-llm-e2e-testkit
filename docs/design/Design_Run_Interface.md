---
title: Design_Run_Interface
version: v0.1.0
status: draft
scope: internal
related:
  - README_Question_Resolution.md
  - docs/spec/Spec_F9-A_Implementation_v0.1r.md
owner: F9-A
last_updated: 2026-01-01
---

# 実行インターフェース設計（Question Resolution）

## 1. 本設計書の目的と対象読者

本設計書は、  
**質問具体化ツール（F9-A）**における  
実行スクリプト（PowerShell / bat）と  
Python 処理本体との間の  
**実行インターフェース（I/F）設計**を定義するものである。

本書は、次の読者を対象とする。

- 本ツールの保守・改修を行う担当者
- 実行スクリプト（ps1 / bat）を実装・修正する担当者
- Python 側の引数仕様を確認・変更する担当者
- README や利用手引書の妥当性を検証するレビュー担当者

一般利用者（職員・評価者）向けの利用手引きではない。  
利用方法については  
**README_Question_Resolution.md** を正本とする。

---

## 2. 実行系コンポーネントの責務分離

本ツールの実行系は、次の 3 つのコンポーネントで構成される。

### 2.1 run_question_resolution.ps1

**役割：**

- 一般ユーザー向けの主実行ルート
- 対話形式で必要な入力を収集する
- 入力内容の存在チェック・最低限の妥当性確認を行う
- `.env` の選択・初期設定を行う
- Python スクリプトを正しい引数で呼び出す

**責務に含まれないもの：**

- 条例構造の解析
- 質問具体化ロジック
- 入力 CSV の内容検証（形式・意味）

---

### 2.2 run_question_resolution.bat

**役割：**

- PowerShell が利用できない環境向けの代替実行手段
- 引数指定中心の最小実行ルート

**制約：**

- 対話は最小限、または行わない
- 入力チェックや案内は簡素になる
- ps1 版と同一の Python 引数 I/F を使用する

---

### 2.3 run_question_resolution.py

**役割：**

- 質問具体化処理の本体
- 条例 HTML・CSV を一次情報として処理を行う
- 条・項の自動解決およびユーザー入力解決を実行する
- 実行結果を出力する

**前提：**

- 実行に必要なパス・設定は  
  すべてコマンドライン引数および環境変数から与えられる
- 実行環境（.env）の選択・切替は ps1 側の責務とする

---

## 3. 実行フロー概要

PowerShell 実行時の全体フローは次のとおりである。

```text
開始
 ↓
起動メッセージ表示
 ↓
実行環境（.env）の選択／初期設定
 ↓
条例データの配置場所を指定
 ↓
対象条例ID一覧CSVを指定
 ↓
質問セットCSVを指定
 ↓
入力内容の存在チェック
 ↓
実行内容の最終確認
 ↓
Python スクリプト呼び出し
 ↓
処理完了メッセージ表示
```

このフローにおいて、

- 入力の収集・確認は ps1 の責務
- 処理内容の正否判断は Python 側の責務

と明確に分離されている。

---

## 4. ps1 → python の引数 I/F 定義

ps1 から Python スクリプトを呼び出す際の
正式な引数 I/F は以下のとおりとする。

| 論理名 | ps1変数 | python引数 | 説明 |
| -------- | --------------- | ----------------- | --------------------------- |
| 条例データルート | `$reikiRoot` | `--reiki-root` | `reiki_menu.html` を含むディレクトリ |
| 対象条例ID一覧 | `$ordinanceCsv` | `--ordinance-csv` | `ordinance_id` を列に持つCSV |
| 質問セット | `$questionCsv` | `--question-csv` | 質問テンプレートを定義したCSV |

**設計原則：**

- 引数名は README で使われている用語と対応させる
- 引数の意味を ps1 側で解釈し直さない
- Python 側では、引数が正しく与えられていることを前提に処理を行う

---

## 5. 実行環境（.env）の扱い

### 5.1 ps1 の責務

- 使用する実行環境（local / test / prod 等）を選択させる
- 初回実行時に、必要な設定項目を入力させる
- 選択された環境に対応する `.env` ファイルを有効化する

### 5.2 python に引数として渡さない理由

実行環境の指定を Python 引数として渡さない理由は以下のとおりである。

- README では、実行環境の選択を「実行前準備」として説明している
- 実行環境は、処理内容ではなく **実行文脈**に属する情報である
- ps1 / bat / python 間で I/F を単純に保つため

このため、Python 側は
**環境変数として設定済みであることを前提**として動作する。

---

## 6. README 第5章との対応関係

README_Question_Resolution.md 第5章は、
一般ユーザー向けの利用手引きであると同時に、
**実行インターフェースの事実上の契約**を定義している。

本設計書は、以下の対応関係を前提とする。

| README 第5章の表現 | 実装上の対応 |
| -------------- | ----------------- |
| 条例データの場所 | `--reiki-root` |
| 対象条例 ID 一覧 CSV | `--ordinance-csv` |
| 質問セット CSV | `--question-csv` |
| 実行環境の選択 | ps1 による `.env` 切替 |

README と実装の間で
この対応関係が崩れないことを
I/F 設計上の制約とする。

---

## 7. 今後の拡張余地と制約

### 7.1 引数追加時のルール

- 新しい引数を追加する場合は、
  README 第5章との対応関係を必ず検討する
- 一般ユーザーに不要な引数は README に露出させない
- bat / ps1 / python の三者で不整合が生じないようにする
- 既存引数の削除は禁止とする
  （不要になった場合は非推奨として扱う）

### 7.2 互換性の考え方

- 既存の引数名・意味を変更する場合は破壊的変更とみなす
- 破壊的変更を行う場合は、README・FAQ・設計書を同時に更新する
- README を正本とし、設計書はその裏付けとする関係を維持する

---
