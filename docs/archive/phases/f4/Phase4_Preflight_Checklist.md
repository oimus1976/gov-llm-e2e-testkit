# 🧪 本番テスト前チェックリスト（Phase 4）

## 0️⃣ 本番テストの位置づけ（最初に合意）

**本番テストの目的はこれだけです：**

> **「submit–probe 相関 v0.2 が、
> 現実的な利用条件下でも “誤解なく・安定して” 観測できるか」**

### ❌ 本番テストでやらないこと

* 回答内容の正しさ（意味・品質）
* RAG 精度評価
* AI の賢さチェック

👉 **E2E 基盤の“観測信頼性”だけを見る**

---

## 1️⃣ テスト対象の固定（スコープ宣言）

### テストするもの

* UI submit（ChatPage.submit v0.6）
* probe_v0.2（GraphQL / REST 観測）
* CI summary 表示（PASS / WARN / INFO）

### テストしないもの

* ask API
* 複数質問の連続対話
* 異常系（ログイン失敗など）

👉 **1ケース＝1 submit** を厳守

---

## 2️⃣ 実行前の環境チェック（Go / No-Go）

### 実行前に必ず確認

* [ ] GitHub Actions が **main ブランチ**で実行される
* [ ] Secrets（QOMMONS_USERNAME / PASSWORD）が正しい
* [ ] `.env` を CI が生成している（PROFILE=internet）
* [ ] probe_v0_2.py は **改変されていない**

**1つでも怪しければ → 実行しない**

---

## 3️⃣ 本番テストで観測すべき項目（一次情報）

### A. submit 側（最低条件）

* [ ] CI が FAIL していない
* [ ] UI submit が完了している（既存 smoke が PASS）

※ submit_id の可視化は **今回は必須ではない**

---

### B. probe 側（核心）

最低限、以下の **どれか 1 つ**が成立すれば合格：

* [ ] GraphQL createData が観測される
* [ ] REST GET /messages が観測される

→ summary.json に **event_count > 0**

---

### C. 相関状態（最重要）

CI summary で次を確認：

* [ ] `correlation_state` が **実値で表示されている**
* [ ] 表示が PASS / WARN / INFO の **いずれか**
* [ ] FAIL と誤解される表現がない

---

## 4️⃣ 合格条件（Success Criteria）

### 🎯 本番テストの「合格」

以下 **すべて満たせば合格**：

* [ ] CI が赤くならない
* [ ] correlation_state が summary に表示される
* [ ] Action Guidance が表示される
* [ ] 結果を見て「次に何をするか」迷わない

👉 **Established である必要はない**

---

## 5️⃣ 想定される結果と判断（分岐表）

| 結果                     | 判断    | 次のアクション   |
| ---------------------- | ----- | --------- |
| Established / PASS     | 🎉 理想 | Phase 5 へ |
| Not Established / WARN | ✅ 合格  | 必要なら再実行   |
| No Evidence / INFO     | ⚠️ 合格 | 連続発生時のみ調査 |
| CI FAIL                | ❌ 不合格 | ログ確認      |

---

## 6️⃣ NG 判定（この場合は止める）

* [ ] correlation_state が表示されない
* [ ] WARN / INFO が FAIL のように見える
* [ ] summary が読みにくく、判断に迷う

→ **基盤改善に戻る（本番テスト続行しない）**

---

## 7️⃣ 本番テスト後にやらないこと（重要）

* 結果が Established でも
  → **すぐに設計をいじらない**
* 1回の結果で
  → **結論を出さない**

👉 本番テストは **“感触確認”**
👉 改善は **次フェーズ**

---

## 8️⃣ 本番テスト完了の宣言文（使ってOK）

> 本番テストにより、submit–probe 相関 v0.2 が
> 実運用条件下でも CI 上で誤解なく可視化できることを確認した。
> 本基盤は次フェーズへ進行可能と判断する。

---

## まとめ（ここが大事）

* 本番テストのゴールは **「正しさ」ではなく「安心」**
* 100点を狙わない
* **迷わなければ合格**

---
