---
title: F4 RAG 評価フェーズ 運用ルール
version: v0.1.5
status: Active (Manual Operation / Stable)
last_updated: 2025-12-XX
scope: F4 (HTML vs Markdown RAG Evaluation)
---

# F4 RAG 評価フェーズ 運用ルール v0.1.5

本書は、gov-llm-e2e-testkit における
**F4：RAG 評価基準・比較テストフェーズ**を、人手運用を前提として
**再現可能かつ誤解のない形で実施するための運用ルール**を定義する。

本バージョン（v0.1.x）では、

- 自動化を最小限に留める
- 曖昧な切替・推測に依存しない
ことを最優先とする。

---

## 0. 前提と位置づけ（重要）

- F4 は **品質評価フェーズ**であり、基盤実装の拡張フェーズではない
- submit / probe / PageObject など **F1–F3 基盤は凍結**されている
- 本ルールは **v0.1 系の暫定的な安定運用ルール**であり、
  自動化・高度化は v0.2 以降で再検討する

---

## 1. ナレッジ構成（v0.1 の確定方針）

### 1.1 基本方針

v0.1 においては、以下を**運用上の確定ルール**とする。

- HTML 用ナレッジと Markdown 用ナレッジは
  **それぞれ別のテストアカウントに紐づけて管理する**
- **同一アカウント内でナレッジを削除し、再投入する運用は行わない**

### 1.2 背景（判断理由）

この方針は、以下の議論と制約を踏まえた結果である。

- Qommons.AI において `chat_name` は
  ユーザーが自由に命名・増設できる対象ではない
- 「プライベートナレッジ」以外の表示名を
  テスト都合で用意できる保証が存在しない
- ナレッジ削除・再投入は
  人的ミス・再現性低下・評価結果の混濁を招く

これらを踏まえ、
**v0.1 では安全側に倒し、アカウント分離による手動切替を採用する**。

※ ナレッジ差し替え方式・自動化は v0.2 以降の検討事項とする。

---

## 2. Case 設計とナレッジの扱い

### 2.1 Case 構成

F4 v0.1 では、以下の **最小 3 ケース**のみを用いる。

- Case 1：目的条文の基本検索（Baseline）
- Case 2：手続・条件条文の検索
- Case 3：例外・限定条件を含む検索

### 2.2 Case 間のナレッジ扱い（重要）

- 各 Case は **同一形式のナレッジセット上で連続実行される**
- Case ごとにナレッジを削除・差し替えする運用は行わない

#### 補足（議論経緯）

当初は
- Case ごとに条例ファイルを入れ替える案
- Case1 の条例を残すか否かの案
も検討されたが、

- 質問文の曖昧化リスク
- 運用手順の複雑化
を避けるため、

**質問文の一意化ルールで解決する方針**を採用した。

---

## 3. 質問文の一意化ルール（必須）

### 3.1 ルール

すべての質問文は、以下を満たさなければならない。

- **対象条例を一意に特定できる情報を必ず含める**
  - 条例ID（例：k518RG00000064）を必須とする

### 3.2 例

❌ NG：

- 「この条例の目的を説明してください」

✅ OK：

- 「この条例（k518RG00000064）の目的を分かりやすく説明してください」

---

## 4. 実行プロファイルと切替方式

### 4.1 profile の意味

- `profile` は **実行ログ・評価結果を識別するためのメタデータ**
- HTML / Markdown のどちらで実行したかを示す
- 自動的に chat やナレッジを切り替える機能ではない

### 4.2 切替方式（v0.1）

v0.1 における切替は **完全手動**とする。

#### 手順概要

1. HTML 用テストアカウントでログイン
2. pytest 実行（`--f4-profile html` を指定）
3. ログ・結果を保存
4. Markdown 用テストアカウントで再ログイン
5. pytest 実行（`--f4-profile markdown` を指定）

※ profile 指定は **記録目的**であり、
　アカウント切替そのものは人手で行う。

---

## 5. 評価結果ログの扱い

### 5.1 命名規約（必須）

評価結果ログは、以下を必ず含む。

- case_id
- profile
- timestamp

例：

```text
F4_results_case1_html_20251215T103012.md
```

### 5.2 上書き禁止

- HTML / Markdown の結果を同一ファイルに上書きしてはならない
- 差分評価は **複数ログを並べて観測する**ことで行う

---

## 6. v0.1 で「やらないこと」

以下は **明示的に対象外**とする。

- chat_name の自動切替
- ナレッジの自動アップロード / 削除
- Case ごとのナレッジ差し替え自動化
- 意味的同義語・高度な意味理解評価
- CI への組み込み

---

## 7. 次フェーズへの引き継ぎ事項

- profile ↔ chat / account / knowledge の自動対応設計
- ナレッジ差し替え方式の再検討
- F4 結果ログの機械集計
- v0.2 評価指標（意味的評価等）

---

## 8. 総括

v0.1 は、

> **「人が迷わず、同じことを繰り返せる」**

ことを最優先に設計された運用ルールである。

高度化・自動化は、
この v0.1 の実測結果を踏まえてから行う。

---
